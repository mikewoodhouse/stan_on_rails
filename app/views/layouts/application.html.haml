!!!
%html
  %head
    %meta{:content => "text/html; charset=UTF-8", "http-equiv" => "Content-Type"}/
    %title Stan
    %meta{:content => "width=device-width,initial-scale=1", :name => "viewport"}/
    = csrf_meta_tags
    = csp_meta_tag
    = stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload'
    = javascript_pack_tag 'application', 'data-turbolinks-track': 'reload'
    = favicon_link_tag asset_path('favicon.ico')
  %body
    %header.main
      =image_tag asset_path('stan.png'), alt: "Stan - The Trinity Oxley Cricket Club Statistical History"
      %p The Trinity Oxley CC Statistical Maroon & Gold Mine
    %section.content
      %nav.side_nav
        %span{style: "color: white;"}
          Players
        %ul
          %li{onclick: 'getReport("players")'} Appearances
          %li= link_to 'Captains', '/players/captains'
        %span{style: "color: white;"}
          Seasons
        %ul
          %li= link_to 'Results', '/seasons'
          %li= link_to 'Records', '/season_records'
        %span{style: "color: white;"}
          Batting
        %ul
          %li=link_to 'Career Average', '/batting/averages'
          %li=link_to 'Career Runs', '/batting/most_runs'
          %li=link_to 'Centuries', '/batting/hundred_plus'
        %span{style: "color: white;"}
          Bowling
        %ul
          %li=link_to 'Career Average', '/bowling/averages'
          %li=link_to 'Career Wickets', '/bowling/wickets'
          %li{onclick: 'getReport("best_bowling")'} Five wickets or more
      %main
        %h1#page_title Report appears here
        #data

:javascript
    function tabulate(report) {
        let cols = report.columns
        let table = document.createElement('table')
        let header = table.createTHead()
        let tr = header.insertRow(-1)
        for (let i = 0; i < cols.length; i++) {
            let th = document.createElement('th')
            th.innerHTML = cols[i].heading
            tr.appendChild(th)
        }
        let body = table.createTBody()
        for(let i = 0; i < report.data.length; i++) {
            tr = body.insertRow(-1)
            tr.className = i % 2 == 0 ? 'even' : 'odd'
            for (let j = 0; j < cols.length; j++) {
                let cel = tr.insertCell(-1)
                cel.innerHTML = report.data[i][cols[j].key]
                cel.className = cols[j].cls
            }
        }
        return table
    }

    function getReport(report_name) {
        let elem = document.getElementById('data')
        elem.innerHtml = ""
        let title = document.getElementById('page_title')
        title.innerHtml = ""

        let xhttp = new XMLHttpRequest()

        xhttp.onload = function() {
            if (this.readyState == 4 && this.status == 200) {
                let report = JSON.parse(this.responseText);
                title.innerText = report.title
                elem.appendChild(tabulate(report));
            }
        }

        xhttp.open("GET", "data/get/" + report_name, true)
        xhttp.send()
    }

